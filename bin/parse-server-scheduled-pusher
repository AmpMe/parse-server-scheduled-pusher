#!/usr/bin/env node
const Parse = require('parse/node');
const { sendScheduledPushes } = require('../src');

const appId = process.env.PARSE_APPLICATION_ID;
Parse.initialize(
  appId,
  process.env.PARSE_JAVASCRIPT_KEY,
  process.env.PARSE_MASTER_KEY
);
Parse.serverURL = process.env.PARSE_URL;

if (typeof process.env.PARSE_MESSAGE_QUEUE_ADAPTER !== 'string') {
  throw new Error('PARSE_MESSAGE_QUEUE_ADAPTER must be defined');
}

const messageQueueAdapter = require(process.env.PARSE_MESSAGE_QUEUE_ADAPTER);
if (typeof messageQueueAdapter.createPublisher !== 'function') {
  throw new Error('Invalid adapter');
}

const channel = process.env.PARSE_PUSH_CHANNEL;
if (typeof channel !== 'string') {
  throw new Error('Invalid channel');
}

const publisher = messageQueueAdapter.createPublisher();
sendScheduledPushes(publisher, channel, appId);
// runPushCampaigns();
